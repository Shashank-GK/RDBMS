CREATE DATABASE ONLINE_SHOPPING;
/* USE ONLINE_SHOPPING; */
CREATE TABLE SALESMAN (SALESMAN_ID INTEGER, SALESMAN_NAME VARCHAR (20), CITY VARCHAR (20), COMMISSION VARCHAR (20), PRIMARY KEY (SALESMAN_ID));
SELECT * FROM SALESMAN;

CREATE TABLE CUSTOMER1 (CUSTOMER_ID INTEGER,CUST_NAME VARCHAR (20),CITY VARCHAR (20),GRADE INTEGER,PRIMARY KEY (CUSTOMER_ID),SALESMAN_ID INTEGER REFERENCES SALESMAN (SALESMAN_ID) ON DELETE SET NULL);
SELECT * FROM CUSTOMER1 ;

CREATE TABLE ORDERS (ORDER_NO INTEGER,PURCHASE_AMT INTEGER, ORD_DATE DATE,PRIMARY KEY (ORDER_NO),CUSTOMER_ID INTEGER REFERENCES CUSTOMER1 (CUSTOMER_ID) ON DELETE CASCADE, SALESMAN_ID INTEGER REFERENCES SALESMAN (SALESMAN_ID) ON DELETE CASCADE);
SELECT * FROM ORDERS;

INSERT INTO SALESMAN VALUES (1000, 'SHASHANK','BANGALORE','25 %'), (2000, 'VEDANTH','BANGALORE','20 %'), (3000, 'DEEPAK','MYSORE','15 %'),(4000, 'VIKAS','DELHI','30 %'),(5000, 'HARSHA','HYDRABAD','15 %');

INSERT INTO CUSTOMER1 VALUES (10, 'SHASHANK','CHITRADURGA', 100, 1000),(11, 'VIVEK','MANGALORE', 300, 1000),(12, 'BHASKAR','CHENNAI', 400, 2000),(13, 'CHETHAN','BANGALORE', 200, 2000),(14, 'MAMATHA','BANGALORE', 400, 3000);

INSERT INTO ORDERS VALUES (50, 5000, '2017-01-04', 10, 1000),(51, 450, '2017-01-17', 10, 2000),(52, 1000, '2017-02-14', 13, 2000),(53, 3500, '2017-03-14', 14, 3000),(54, 550, '2017-03-14', 12, 2000);

/* Count the customers with grades above Bangalore’s average. */
SELECT GRADE, COUNT (DISTINCT CUSTOMER_ID) 
FROM CUSTOMER1
GROUP BY GRADE
HAVING GRADE > (SELECT AVG(GRADE) 
FROM CUSTOMER1
WHERE CITY='BANGALORE');

/* Find the name and numbers of all salesmen who had more than one customer. */
SELECT SALESMAN_ID,SALESMAN_NAME 
FROM SALESMAN A
WHERE 1 < (SELECT COUNT (*) 
FROM CUSTOMER1
WHERE SALESMAN_ID=A.SALESMAN_ID);

